<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÅâÈãºÂΩ∞Êø±Âª†ÂçÄÁõ£Ë¶ñÂô®‰ΩçÁΩÆÊü•Ë©¢Á≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #ecf0f1;
            height: 100dvh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100dvh;
            position: relative;
        }

        /* ÂÅ¥ÈÇäÊ¨Ñ */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar-header h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .search-box {
            position: relative;
            margin-top: 10px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            outline: none;
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Êñ∞Â¢ûÔºöÊ∏ÖÈô§ÊåâÈàïÊ®£Âºè */
        .clear-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .clear-search-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .zone-section {
            margin: 10px 0;
        }

        .zone-title {
            padding: 10px 20px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: bold;
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            padding: 0 15px;
        }

        .camera-btn {
            padding: 6px 2px;
            border: 2px solid #3498db;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }

        .camera-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .camera-btn.active {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 30px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        /* ‰∏ªË¶ÅÂÖßÂÆπÂçÄ */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .map-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .map-container:active {
            cursor: grabbing;
        }

        .map-content {
            position: absolute;
            transform-origin: 0 0;
            transition: transform 0.01s ease;
        }

        .floor-plan {
            display: block;
            height: auto;
            user-select: none;
        }

        /* Áõ£Ë¶ñÂô®Ê®ôË®ò */
        .camera-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border: 2px solid white;
            border-radius: 90%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .camera-marker:hover {
            transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5);
        }

        .camera-marker.active {
            background: #FF5809;
            animation: pulse 2s infinite;
            transform: translate(-50%, -50%) scale(1.7);
            }

        .camera-marker .label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .camera-marker:hover .label {
            opacity: 1;
        }

        /* ÊéßÂà∂Èù¢Êùø */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .zoom-controls {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .zoom-btn:hover {
            background: #3498db;
            color: white;
        }

        .zoom-btn:not(:last-child) {
            border-bottom: 1px solid #ecf0f1;
        }

        /* Ë≥áË®äÈù¢Êùø */
        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            width: 220px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .info-panel.active {
            transform: translateY(0);
            opacity: 1;
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 20px;
            padding-right: 35px;
        }

        .info-panel p {
            color: #7f8c8d;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .close-info-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: #95a5a6;
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-info-btn:hover {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        /* ÊâãÊ©üÁ´ØÈÅ©ÈÖç */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                height: 100dvh;
                transform: translateX(-100%);
                z-index: 2000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                width: 100%;
            }

            .menu-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 2001;
                background: rgba(255, 255, 255, 0.95);
                border: none;
                border-radius: 8px;
                padding: 10px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .camera-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }

            .info-panel {
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>ÂÅâÈãºÂΩ∞Êø±Âª†ÂçÄ<br>Áõ£Ë¶ñÂô®‰ΩçÁΩÆÊü•Ë©¢Á≥ªÁµ±</h2>

                 <button onclick="showPdfModal()" style="
                 margin-top: 8px;
                 background-color: #ffffff4;
                 border: 1px solid #fff;
                 border-radius: 6px;
                 padding: 6px 12px;
                 font-size: 13px;
                 color: #2c3e50;
                 cursor: pointer;
                 transition: background 0.2s;
                 ">üîé Êü•Áúã‰ΩøÁî®Ë™™Êòé</button>

                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ÊêúÂ∞ãÁõ£Ë¶ñÂô®Á∑®Ëôü..." oninput="handleSearchInput()">
                    <button id="clearSearchBtn" class="clear-search-btn" onclick="clearSearch()" style="display: none;">‚úï</button>
                </div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">AÔºàË≠¶Ë°õÂÆ§INPUT1Ôºâ</div>
                <div class="camera-grid" id="zoneA"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">BÔºàË≠¶Ë°õÂÆ§INPUT2Ôºâ</div>
                <div class="camera-grid" id="zoneB"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">CÔºàË≠¶Ë°õÂÆ§INPUT3Ôºâ</div>
                <div class="camera-grid" id="zoneC"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">DÔºàËæ¶ÂÖ¨ÂÆ§Ôºâ</div>
                <div class="camera-grid" id="zoneD"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container" id="mapContainer">
                <div class="map-content" id="mapContent">
                    <img id="floorImage" src="Áõ£Ë¶ñÂô®.png" class="floor-plan" />
                        <!-- Âª∫ÁØâÁâ©Â§ñÊ°Ü -->
                       
                </div>
            </div>
            
            <div class="controls">
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn" onclick="zoomOut()">-</button>
                </div>
            </div>
            
            <div class="info-panel" id="infoPanel">
                <button class="close-info-btn" onclick="closeInfoPanel()">‚úï</button>
                <h3 id="infoTitle">Ë´ãÈÅ∏ÊìáÁõ£Ë¶ñÂô®</h3>
                <p id="infoLocation">‰ΩçÁΩÆ: --</p>
                <p id="infoZone">ÈÄ£Êé•Âü†: --</p>
                </div>
        </div>
    </div>

    <script>
        // Áõ£Ë¶ñÂô®Êï∏Êìö
        const cameras = {
            A: ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10', 'A11', 'A12'],
            B: ['B1', 'B2', 'B3', 'B4', 'B5', 'B6', 'B7', 'B8', 'B9', 'B10', 'B11', 'B12', 'B13', 'B14', 'B15', 'B16', 'B17', 'B18', 'B19', 'B20', 'B21', 'B22', 'B23', 'B24'],
            C: ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14', 'C15', 'C16', 'C17', 'C18', 'C19', 'C20', 'C21', 'C22', 'C23', 'C24'],
            D: ['D1', 'D2']
        };

        // Áõ£Ë¶ñÂô®‰ΩçÁΩÆÈÖçÁΩÆ - Ê†πÊìöÂπ≥Èù¢ÂúñÂØ¶Èöõ‰ΩçÁΩÆ
        const cameraPositions = {
            // AÂçÄ
            A1: { x: 611, y: 673, area: '‰∏ÄÊ®ìÂ∑¶Ê¢ØÂêëÂâç' },
            A2: { x: 611, y: 320, area: '‰∏ÄÊ®ìÂè≥Ê¢ØÂêëÂâç' },
            A3: { x: 530, y: 851, area: 'ÁÑäÊùêÁÆ°Âà∂ÂÆ§' },
            A4: { x: 595, y: 305, area: 'ÊúÉË≠∞ÂÆ§' },
            A5: { x: 135, y: 135, area: 'ÂΩ∞Êø±ÂÄâ2F' },
            A6: { x: 116, y: 322, area: 'Âè≥ÂæåÂ∑∑' },
            A7: { x: 116, y: 675, area: 'Â∑¶ÂæåÂ∑∑-1' },
            A8: { x: 610, y: 1636, area: '‰∫åÊ®ìÂè≥Ê¢ØÂêëÂâç' },
            A9: { x: 595, y: 1634, area: '‰∫åÊ®ìÂè≥Ê¢ØÂêëÂæå' },
            A10: { x: 595, y: 2015, area: '‰∫åÊ®ìÂ∑¶Ê¢ØÂêëÂæå' },
            A11: { x: 610, y: 2013, area: '‰∫åÊ®ìÂ∑¶Ê¢ØÂêëÂâç' },
            A12: { x: 68, y: 855, area: 'Â∑¶ÂæåÂ∑∑-2' },
 

            // BÂçÄ
            B1: { x: 1393, y: 123, area: 'Âª†Â§ñÂè≥ÂâçÂêëÂæå' },
            B2: { x: 930, y: 119, area: 'Âè≥‰∏≠Êç≤ÈñÄÂêëÂâç' },
            B3: { x: 990, y: 119, area: 'Âè≥‰∏≠Êç≤ÈñÄÂêëÂæå' },
            B4: { x: 65, y: 675, area: 'Âª†Â§ñÁãóÂ±ã' },
            B5: { x: 1392, y: 418, area: 'ÂâçÊç≤ÈñÄÂÖßÂè≥ÂÅ¥' },
            B6: { x: 1392, y: 583, area: 'ÂâçÊç≤ÈñÄÂÖßÂ∑¶ÂÅ¥' },
            B7: { x: 1392, y: 848, area: 'Âª†ÂÖßÂ∑¶Ââç' },
            B8: { x: 815, y: 1175, area: 'ÂΩ∞Êø±Ë•ø3F' },
            B9: { x: 611, y: 133, area: 'Âª†ÂÖßÂè≥‰∏≠' },
            B10: { x: 598, y: 670, area: '‰∏ÄÊ®ìÂ∑¶Ê¢ØÂêëÂæå' },
            B11: { x: 585, y: 328, area: 'Âè≥‰∏≠Ê¢ØÂêëÂæå' },
            B12: { x: 125, y: 298, area: 'ÂΩ∞Êø±ÂÄâ1F-1' },
            B13: { x: 133, y: 313, area: 'ÂΩ∞Êø±ÂÄâ1F-2' },
            B14: { x: 131, y: 691, area: 'Âô¥Á†ÇÂÆ§ÂÖßÂêëÂâç' },
            B15: { x: 177, y: 677, area: 'Âô¥Á†ÇÂÆ§Â§ñÂêëÂâç' },
            B16: { x: 127, y: 1630, area: 'ÂΩ∞Êø±Êù±2FÂæå' },
            B17: { x: 1392, y: 151, area: 'Âª†ÂÖßÂè≥Ââç' },
            B18: { x: 345, y: 1173, area: 'ÈõªÊ∞£ÂÆ§' },
            B19: { x: 990, y: 863, area: 'Â∑¶‰∏≠Êç≤ÈñÄÂÖßÂÅ¥' },
            B20: { x: 370, y: 855, area: 'Ë™øÊºÜÂÆ§ÂêëÂÖß' },
            B21: { x: 355, y: 853, area: 'Âô¥Á†ÇÂÆ§ÂÖßÂêëÂæå' },
            B22: { x: 370, y: 692, area: 'Ë™øÊºÜÂÆ§ÂêëÂ§ñ' },
            B23: { x: 127, y: 2017, area: 'ÂΩ∞Êø±Ë•ø2FÂæå' },
            B24: { x: 68, y: 855, area: 'Â∑¶ÂæåÂ∑∑-2' },

            // CÂçÄ
            C1: { x: 2054, y: 614, area: 'Ë≠¶Ë°õÂÆ§ÂêëÂ§ßÈñÄ' },
            C2: { x: 2167, y: 1107, area: 'Â∑¶Â∞èÈñÄ' },
            C3: { x: 2153, y: 850, area: 'ÈÖçÈõªÂÆ§ÂêëÂ∑¶Â∞èÈñÄ' },
            C4: { x: 2050, y: 863, area: 'ÈÖçÈõªÂÆ§ÂêëÂª£Â†¥' },
            C5: { x: 2044, y: 614, area: 'Ë≠¶Ë°õÂÆ§ÂêëÂª£Â†¥' },
            C6: { x: 2170, y: 642, area: 'Â§ñÂ∑¶Â§ßÈñÄ' },
            C7: { x: 2170, y: 423, area: 'Â§ñÂè≥Â§ßÈñÄ' },
            C8: { x: 2165, y: 61, area: 'Âè≥ÂâçÂúçÁâÜ' },
            C9: { x: 1405, y: 135, area: 'Âª†Â§ñÂè≥ÂâçÂêëÂâç' },
            C10: { x: 1404, y: 422, area: 'ÂâçÊç≤ÈñÄÂ§ñÂè≥ÂÅ¥' },
            C11: { x: 1404, y: 580, area: 'ÂâçÊç≤ÈñÄÂ§ñÂ∑¶ÂÅ¥' },
            C12: { x: 1405, y: 863, area: 'Âª†Â§ñÂ∑¶ÂâçÂêëÂâç' },
            C13: { x: 1535, y: 1063, area: 'Â∑¶ÂúçÁâÜ‰∏≠Ââç' },
            C14: { x: 950, y: 1018, area: 'Â∑¶ÂúçÁâÜ‰∏≠Âæå' },
            C15: { x: 1394, y: 875, area: 'Âª†Â§ñÂ∑¶ÂâçÂêëÂæå' },
            C16: { x: 930, y: 878, area: 'Â∑¶‰∏≠Êç≤ÈñÄÂêëÂâç' },
            C17: { x: 990, y: 878, area: 'Â∑¶‰∏≠Êç≤ÈñÄÂêëÂæå' },
            C18: { x: 600, y: 874, area: 'ÈõªÊ∞£ÂÆ§Ê®ìÊ¢ØÂâç' },
            C19: { x: 440, y: 878, area: 'Â∑¶ÂæåÊç≤ÈñÄÂêëÂæå' },
            C20: { x: 125, y: 873, area: 'Âª†Â§ñÂ∑¶ÂæåÂêëÂâç' },
            C21: { x: 115, y: 868, area: 'Âª†Â§ñÂ∑¶ÂæåÂêëÂæå' },
            C22: { x: 117, y: 128, area: 'Âª†Â§ñÂè≥ÂæåÂêëÂæå' },
            C23: { x: 33, y: 60, area: 'Âè≥ÂæåÂúçÁâÜ' },
            C24: { x: 125, y: 124, area: 'Âª†Â§ñÂè≥ÂæåÂêëÂâç' },

            // DÂçÄ
            D1: { x: 2175, y: 580, area: 'ÈñÄÈà¥' },
            D2: { x: 2066, y: 626, area: 'Ë≠¶Ë°õÂÆ§Â±ãÁ∞∑ÂêëÂ§ñ' },
           
        };

        let currentZoom = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let selectedCamera = null;
        let panLocked = false; // ÊéßÂà∂Âπ≥ÁßªÈéñÂÆö

        // ÂàùÂßãÂåñ
        function init() {
            createCameraButtons();
            createCameraMarkers();
            setupEventListeners();
            updateInfoPanel();
        }

        // ÂâµÂª∫Áõ£Ë¶ñÂô®ÊåâÈàï
        function createCameraButtons() {
            Object.keys(cameras).forEach(zone => {
                const container = document.getElementById(`zone${zone}`);
                cameras[zone].forEach(camera => {
                    const button = document.createElement('button');
                    button.className = 'camera-btn';
                    button.textContent = camera;
                    button.onclick = () => selectCamera(camera);
                    container.appendChild(button);
                });
            });
        }

        // ÂâµÂª∫Áõ£Ë¶ñÂô®Ê®ôË®ò
        function createCameraMarkers() {
            const mapContent = document.getElementById('mapContent');
            
            Object.keys(cameras).forEach(zone => {
                cameras[zone].forEach(camera => {
                    const marker = document.createElement('div');
                    marker.className = 'camera-marker';
                    marker.id = `marker-${camera}`;
                    
                    // ‰ΩøÁî®ÂØ¶Èöõ‰ΩçÁΩÆÂ∫ßÊ®ô
                    const pos = cameraPositions[camera];
                    if (pos) {
                        marker.style.left = pos.x + 'px';
                        marker.style.top = pos.y + 'px';
                        marker.onclick = () => selectCamera(camera);
                        
                        const label = document.createElement('div');
                        label.className = 'label';
                        label.textContent = camera;
                        marker.appendChild(label);
                        
                        mapContent.appendChild(marker);
                    }
                });
            });
        }

        // ÈÅ∏ÊìáÁõ£Ë¶ñÂô®
        function selectCamera(cameraId) {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÈÅ∏Êìá
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });

            // Ë®≠ÁΩÆÊñ∞ÁöÑÈÅ∏Êìá
            selectedCamera = cameraId;
            const button = [...document.querySelectorAll('.camera-btn')].find(btn => btn.textContent === cameraId);
            const marker = document.getElementById(`marker-${cameraId}`);
            
            if (button) button.classList.add('active');
            if (marker) marker.classList.add('active');

            // ÁßªÂãïÂà∞Áõ£Ë¶ñÂô®‰ΩçÁΩÆ
            const pos = cameraPositions[cameraId];
            
            if (pos) {
                panToPosition(pos.x, pos.y);
                const zone = cameraId.charAt(0);
                updateInfoPanel(cameraId, zone, pos.area);
            }

            // ÊâãÊ©üÁ´ØËá™ÂãïÈóúÈñâÂÅ¥ÈÇäÊ¨Ñ
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        // ÁßªÂãïÂà∞ÊåáÂÆö‰ΩçÁΩÆ
        function panToPosition(x, y) {
            const container = document.getElementById('mapContainer');
            const containerRect = container.getBoundingClientRect();
            
            // Ë®àÁÆóÂ±Ö‰∏≠‰ΩçÁΩÆ
            const centerX = containerRect.width / 2;
            const centerY = containerRect.height / 2;
            
            currentX = centerX - x * currentZoom;
            currentY = centerY - y * currentZoom;
            
            updateMapTransform();
        }

        // Êõ¥Êñ∞Âú∞ÂúñËÆäÊèõ
        function updateMapTransform() {
            const mapContent = document.getElementById('mapContent');
            mapContent.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentZoom})`;
        }

        // Á∏ÆÊîæÂäüËÉΩ
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 5);
            updateMapTransform();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.5);
            updateMapTransform();
        }

        // ÊêúÂ∞ãÂäüËÉΩ

        // ËôïÁêÜÊêúÂ∞ãËº∏ÂÖ•
        function handleSearchInput() {
            toggleClearButton();
            searchCameras();
        }

        function searchCameras() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
            let visibleCount = 0;
            let lastVisibleDevice = null;
    
            // ÈÅçÊ≠∑ÊâÄÊúâÁõ£Ë¶ñÂô®ÊåâÈàï
            document.querySelectorAll('.camera-btn').forEach((button) => {
                const cameraId = button.textContent;
        
                if (cameraId.toLowerCase().includes(searchTerm)) {
                    button.style.display = 'block';
                    visibleCount++;
                    lastVisibleDevice = cameraId;
                } else {
                    button.style.display = 'none';
                }
            });
    
            // Â¶ÇÊûúÊêúÂ∞ãÁµêÊûúÂîØ‰∏ÄÔºåËá™ÂãïÈÅ∏Êìá
            if (visibleCount === 1 && lastVisibleDevice) {
                selectCamera(lastVisibleDevice);
            }
        }

        // Êñ∞Â¢ûÔºöÈ°ØÁ§∫/Èö±ËóèÊ∏ÖÈô§ÊåâÈàï
        function toggleClearButton() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
    
            if (searchInput.value.length > 0) {
                clearBtn.style.display = 'flex';
            } else {
                clearBtn.style.display = 'none';
            }
        }

        // Êñ∞Â¢ûÔºöÊ∏ÖÈô§ÊêúÂ∞ã
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = '';
    
            // Èö±ËóèÊ∏ÖÈô§ÊåâÈàï
            toggleClearButton();
    
            // È°ØÁ§∫ÊâÄÊúâÊåâÈàï
            document.querySelectorAll('.camera-btn').forEach((button) => {
                button.style.display = 'block';
            });
    
            // Ê∏ÖÈô§ÈÅ∏ÊìáÁãÄÊÖã
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });
    
            // ÈáçÁΩÆÈÅ∏ÊìáÁöÑÁõ£Ë¶ñÂô®
            selectedCamera = null;
    
    }

        // Êõ¥Êñ∞Ë≥áË®äÈù¢Êùø
        function updateInfoPanel(cameraId, zone, area) {
            const panel = document.getElementById('infoPanel');
            
            if (cameraId) {
                document.getElementById('infoTitle').textContent = `Áõ£Ë¶ñÂô® ${cameraId}`;
                document.getElementById('infoLocation').textContent = `‰ΩçÁΩÆ: ${area}`;
                document.getElementById('infoZone').textContent = `ÈÄ£Êé•Âü†: ${zone}`;
                panel.classList.add('active');
            } else {
                document.getElementById('infoTitle').textContent = 'Ë´ãÈÅ∏ÊìáÁõ£Ë¶ñÂô®';
                document.getElementById('infoLocation').textContent = '‰ΩçÁΩÆ: --';
                document.getElementById('infoZone').textContent = 'ÂçÄÂüü: --';
                panel.classList.remove('active');
            }
        }

        // ÈóúÈñâË≥áË®äÈù¢Êùø
        function closeInfoPanel() {
            // Ê∏ÖÈô§ÈÅ∏ÊìáÁãÄÊÖã
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });
    
            // ÈáçÁΩÆÈÅ∏ÊìáÁöÑÁõ£Ë¶ñÂô®
            selectedCamera = null;
    
            // Êõ¥Êñ∞Ë≥áË®äÈù¢ÊùøÔºàÊúÉËá™ÂãïÈö±ËóèÔºâ
            updateInfoPanel();
        }

        // Ë®≠ÁΩÆ‰∫ã‰ª∂Áõ£ËÅΩÂô®
        function setupEventListeners() {
            const mapContainer = document.getElementById('mapContainer');
            
            // ÊªëÈº†‰∫ã‰ª∂
            mapContainer.addEventListener('mousedown', startDrag);
            mapContainer.addEventListener('wheel', handleWheel);
            
            // Ëß∏Êéß‰∫ã‰ª∂
            mapContainer.addEventListener('touchstart', handleTouchStart);
            mapContainer.addEventListener('touchmove', handleTouchMove);
            mapContainer.addEventListener('touchend', handleTouchEnd);
            
            // ÈçµÁõ§‰∫ã‰ª∂
            document.addEventListener('keydown', handleKeyDown);
        }

        // ÊãñÊãΩÂäüËÉΩ
        function startDrag(e) {
            if (e.button !== 0) return; // Âè™ÈüøÊáâÂ∑¶Èçµ

            isDragging = true;
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;

            // Âú® document ‰∏äÊ∑ªÂä†‰∫ã‰ª∂Áõ£ËÅΩÂô®
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
    
            e.preventDefault(); // Èò≤Ê≠¢ÈÅ∏ÂèñÊñáÂ≠ó
        }

        function drag(e) {
            if (!isDragging) return;
            
            const deltaX = e.clientX - dragStart.x;
            const deltaY = e.clientY - dragStart.y;

            currentX += deltaX;
            currentY += deltaY;
    
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;
    
            updateMapTransform();
        }

        function endDrag() {
            isDragging = false;

            // ÁßªÈô§‰∫ã‰ª∂Áõ£ËÅΩÂô®
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', endDrag);
        }

        // ÊªæËº™Á∏ÆÊîæ
        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newZoom = Math.max(0.2, Math.min(5, currentZoom * delta));
            
            if (newZoom !== currentZoom) {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                currentX = x - (x - currentX) * (newZoom / currentZoom);
                currentY = y - (y - currentY) * (newZoom / currentZoom);
                currentZoom = newZoom;
                
                updateMapTransform();
            }
        }

        // Ëß∏Êéß‰∫ã‰ª∂
        let lastTouchDistance = 0;
        let touchStartX = 0;
        let touchStartY = 0;

        function handleTouchStart(e) {
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].clientX - currentX;
                touchStartY = e.touches[0].clientY - currentY;
            } else if (e.touches.length === 2) {
                lastTouchDistance = getTouchDistance(e.touches);
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            
            if (e.touches.length === 1) {
                // Ê™¢Êü•ÊòØÂê¶Âú®Âπ≥ÁßªÈéñÂÆöÊúüÈñì
                if (!panLocked) {
                    currentX = e.touches[0].clientX - touchStartX;
                    currentY = e.touches[0].clientY - touchStartY;
                    updateMapTransform();
                }

            } else if (e.touches.length === 2) {
                const distance = getTouchDistance(e.touches);
                const delta = distance / lastTouchDistance;
                const newZoom = Math.max(0.5, Math.min(5, currentZoom * delta));
                
                if (newZoom !== currentZoom) {
                    // Â¶ÇÊûúÊúâÈÅ∏‰∏≠ÁöÑÁõ£Ë¶ñÂô®Ôºå‰ª•Ëû¢Âπï‰∏≠ÂøÉÁÇ∫Á∏ÆÊîæ‰∏≠ÂøÉ
                    if (selectedCamera && cameraPositions[selectedCamera]) {
                        const container = document.getElementById('mapContainer');
                        const containerRect = container.getBoundingClientRect();
                        const pos = cameraPositions[selectedCamera];

                        // Ë®àÁÆóËû¢Âπï‰∏≠ÂøÉÈªû
                        const screenCenterX = containerRect.width / 2;
                        const screenCenterY = containerRect.height / 2;

                     
                    // Ë™øÊï¥ÂÅèÁßªÈáèÔºå‰ΩøÁõ£Ë¶ñÂô®‰øùÊåÅÂú®Ëû¢Âπï‰∏≠ÂøÉ
                   currentX = screenCenterX - pos.x * newZoom;
                   currentY = screenCenterY - pos.y * newZoom;
                }

                    currentZoom = newZoom;
                    updateMapTransform();

                    // ÈéñÂÆöÂπ≥ÁßªÂäüËÉΩ2Áßí
                    panLocked = true;
                    setTimeout(() => {
                        panLocked = false;
                    }, 2000);
                }
                
                lastTouchDistance = distance;
            }
        }

        function handleTouchEnd(e) {
            if (e.touches.length === 0) {
                touchStartX = 0;
                touchStartY = 0;
            }
        }

        function getTouchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // ÈçµÁõ§Âø´Êç∑Èçµ
        function handleKeyDown(e) {
            switch(e.key) {
                case '+':
                case '=':
                    zoomIn();
                    break;
                case '-':
                    zoomOut();
                    break;
                case 'Escape':
                    selectedCamera = null;
                    document.querySelectorAll('.camera-btn.active').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelectorAll('.camera-marker.active').forEach(marker => {
                        marker.classList.remove('active');
                    });
                    updateInfoPanel();
                    break;
            }
        }

        // ÂÅ¥ÈÇäÊ¨ÑÂàáÊèõ
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // ÂàùÂßãÂåñÁ≥ªÁµ±
        init();

        function closeModal() {
            document.getElementById("pdfModal").style.display = "none";
            localStorage.setItem("pdfModalClosed", "true"); // Ë®òÈåÑÂ∑≤ÈóúÈñâ
        }

        function showPdfModal() {
          document.getElementById("pdfModal").style.display = "block";
        }

        window.addEventListener('load', () => {
            // Â¶ÇÊûú localStorage Ë£°Ê≤íÊúâË®òÈåÑÔºåÈ°ØÁ§∫ÂΩàÁ™ó
            if (!localStorage.getItem("pdfModalClosed")) {
                setTimeout(() => {
                    document.getElementById("pdfModal").style.display = "block";
                }, 500); // Âª∂ÈÅ≤ 0.5 ÁßíË∑≥Âá∫
            }
        });


    </script>
    </script>

    <!-- üìÑ ‰ΩøÁî®Ë™™ÊòéÂΩàÁ™ó -->
    <div id="pdfModal" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #FFFFDF;
        padding: 20px 30px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        border-radius: 12px;
        z-index: 3000;
        max-width: 90%;
        width: 400px;
        text-align: center;
        display: none;
    ">
      <button onclick="closeModal()" style="
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #999;
      ">&times;</button>
      <h3 style="margin-bottom: 12px;">üìÑ ‰ΩøÁî®Ë™™Êòé</h3>
      <p>Ë´ãÂèÉÈñ±Êìç‰ΩúÊåáÂçóÔºö<br>
        <a href="how to use.pdf" target="_blank" style="color: #3498db;">ÈªûÊàë‰∏ãËºâ PDF</a>
      </p>
    </div>


</body>
</html>