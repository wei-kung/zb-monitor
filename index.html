<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰é‹¼å½°æ¿±å» å€ç›£è¦–å™¨ä½ç½®æŸ¥è©¢ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #ecf0f1;
            height: 100dvh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100dvh;
            position: relative;
        }

        /* å´é‚Šæ¬„ */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar-header h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .search-box {
            position: relative;
            margin-top: 10px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            outline: none;
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* æ–°å¢ï¼šæ¸…é™¤æŒ‰éˆ•æ¨£å¼ */
        .clear-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .clear-search-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .zone-section {
            margin: 10px 0;
        }

        .zone-title {
            padding: 10px 20px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: bold;
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            padding: 0 15px;
        }

        .camera-btn {
            padding: 6px 2px;
            border: 2px solid #3498db;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }

        .camera-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .camera-btn.active {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 30px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        /* ä¸»è¦å…§å®¹å€ */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .map-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .map-container:active {
            cursor: grabbing;
        }

        .map-content {
            position: absolute;
            transform-origin: 0 0;
            transition: transform 0.01s ease;
        }

        .floor-plan {
            display: block;
            height: auto;
            user-select: none;
        }

        /* ç›£è¦–å™¨æ¨™è¨˜ */
        .camera-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border: 2px solid white;
            border-radius: 90%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .camera-marker:hover {
            transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5);
        }

        .camera-marker.active {
            background: #FF5809;
            animation: pulse 2s infinite;
            transform: translate(-50%, -50%) scale(1.7);
            }

        .camera-marker .label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .camera-marker:hover .label {
            opacity: 1;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .zoom-controls {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .zoom-btn:hover {
            background: #3498db;
            color: white;
        }

        .zoom-btn:not(:last-child) {
            border-bottom: 1px solid #ecf0f1;
        }

        /* è³‡è¨Šé¢æ¿ */
        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            width: 220px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .info-panel.active {
            transform: translateY(0);
            opacity: 1;
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 20px;
            padding-right: 35px;
        }

        .info-panel p {
            color: #7f8c8d;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .close-info-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: #95a5a6;
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-info-btn:hover {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        /* æ‰‹æ©Ÿç«¯é©é… */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                height: 100dvh;
                transform: translateX(-100%);
                z-index: 2000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                width: 100%;
            }

            .menu-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 2001;
                background: rgba(255, 255, 255, 0.95);
                border: none;
                border-radius: 8px;
                padding: 10px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .camera-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }

            .info-panel {
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>å‰é‹¼å½°æ¿±å» å€<br>ç›£è¦–å™¨ä½ç½®æŸ¥è©¢ç³»çµ±</h2>

                 <button onclick="showPdfModal()" style="
                 margin-top: 8px;
                 background-color: #ffffff4;
                 border: 1px solid #fff;
                 border-radius: 6px;
                 padding: 6px 12px;
                 font-size: 13px;
                 color: #2c3e50;
                 cursor: pointer;
                 transition: background 0.2s;
                 ">ğŸ” æŸ¥çœ‹ä½¿ç”¨èªªæ˜</button>

                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœå°‹ç›£è¦–å™¨ç·¨è™Ÿ..." oninput="handleSearchInput()">
                    <button id="clearSearchBtn" class="clear-search-btn" onclick="clearSearch()" style="display: none;">âœ•</button>
                </div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">Aï¼ˆè­¦è¡›å®¤INPUT1ï¼‰</div>
                <div class="camera-grid" id="zoneA"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">Bï¼ˆè­¦è¡›å®¤INPUT2ï¼‰</div>
                <div class="camera-grid" id="zoneB"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">Cï¼ˆè­¦è¡›å®¤INPUT3ï¼‰</div>
                <div class="camera-grid" id="zoneC"></div>
            </div>
            
            <div class="zone-section">
                <div class="zone-title">Dï¼ˆè¾¦å…¬å®¤ï¼‰</div>
                <div class="camera-grid" id="zoneD"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container" id="mapContainer">
                <div class="map-content" id="mapContent">
                    <img id="floorImage" src="ç›£è¦–å™¨.png" class="floor-plan" />
                        <!-- å»ºç¯‰ç‰©å¤–æ¡† -->
                       
                </div>
            </div>
            
            <div class="controls">
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn" onclick="zoomOut()">-</button>
                </div>
            </div>
            
            <div class="info-panel" id="infoPanel">
                <button class="close-info-btn" onclick="closeInfoPanel()">âœ•</button>
                <h3 id="infoTitle">è«‹é¸æ“‡ç›£è¦–å™¨</h3>
                <p id="infoLocation">ä½ç½®: --</p>
                <p id="infoZone">é€£æ¥åŸ : --</p>
                </div>
        </div>
    </div>

    <script>
        // ç›£è¦–å™¨æ•¸æ“š
        const cameras = {
            A: ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10', 'A11', 'A12'],
            B: ['B1', 'B2', 'B3', 'B4', 'B5', 'B6', 'B7', 'B8', 'B9', 'B10', 'B11', 'B12', 'B13', 'B14', 'B15', 'B16', 'B17', 'B18', 'B19', 'B20', 'B21', 'B22', 'B23', 'B24'],
            C: ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14', 'C15', 'C16', 'C17', 'C18', 'C19', 'C20', 'C21', 'C22', 'C23', 'C24'],
            D: ['D1', 'D2']
        };

        // ç›£è¦–å™¨ä½ç½®é…ç½® - æ ¹æ“šå¹³é¢åœ–å¯¦éš›ä½ç½®
        const cameraPositions = {
            // Aå€
            A1: { x: 611, y: 673, area: 'ä¸€æ¨“å·¦æ¢¯å‘å‰' },
            A2: { x: 611, y: 320, area: 'ä¸€æ¨“å³æ¢¯å‘å‰' },
            A3: { x: 530, y: 851, area: 'ç„Šæç®¡åˆ¶å®¤' },
            A4: { x: 595, y: 305, area: 'æœƒè­°å®¤' },
            A5: { x: 135, y: 135, area: 'å½°æ¿±å€‰2F' },
            A6: { x: 116, y: 322, area: 'å³å¾Œå··' },
            A7: { x: 116, y: 675, area: 'å·¦å¾Œå··-1' },
            A8: { x: 610, y: 1636, area: 'äºŒæ¨“å³æ¢¯å‘å‰' },
            A9: { x: 595, y: 1634, area: 'äºŒæ¨“å³æ¢¯å‘å¾Œ' },
            A10: { x: 595, y: 2015, area: 'äºŒæ¨“å·¦æ¢¯å‘å¾Œ' },
            A11: { x: 610, y: 2013, area: 'äºŒæ¨“å·¦æ¢¯å‘å‰' },
            A12: { x: 68, y: 855, area: 'å·¦å¾Œå··-2' },
 

            // Bå€
            B1: { x: 1393, y: 123, area: 'å» å¤–å³å‰å‘å¾Œ' },
            B2: { x: 930, y: 119, area: 'å³ä¸­æ²é–€å‘å‰' },
            B3: { x: 990, y: 119, area: 'å³ä¸­æ²é–€å‘å¾Œ' },
            B4: { x: 65, y: 675, area: 'å» å¤–ç‹—å±‹' },
            B5: { x: 1392, y: 418, area: 'å‰æ²é–€å…§å³å´' },
            B6: { x: 1392, y: 583, area: 'å‰æ²é–€å…§å·¦å´' },
            B7: { x: 1392, y: 848, area: 'å» å…§å·¦å‰' },
            B8: { x: 815, y: 1175, area: 'å½°æ¿±è¥¿3F' },
            B9: { x: 611, y: 133, area: 'å» å…§å³ä¸­' },
            B10: { x: 598, y: 670, area: 'ä¸€æ¨“å·¦æ¢¯å‘å¾Œ' },
            B11: { x: 585, y: 328, area: 'å³ä¸­æ¢¯å‘å¾Œ' },
            B12: { x: 125, y: 298, area: 'å½°æ¿±å€‰1F-1' },
            B13: { x: 133, y: 313, area: 'å½°æ¿±å€‰1F-2' },
            B14: { x: 131, y: 691, area: 'å™´ç ‚å®¤å…§å‘å‰' },
            B15: { x: 177, y: 677, area: 'å™´ç ‚å®¤å¤–å‘å‰' },
            B16: { x: 127, y: 1630, area: 'å½°æ¿±æ±2Få¾Œ' },
            B17: { x: 1392, y: 151, area: 'å» å…§å³å‰' },
            B18: { x: 345, y: 1173, area: 'é›»æ°£å®¤' },
            B19: { x: 990, y: 863, area: 'å·¦ä¸­æ²é–€å…§å´' },
            B20: { x: 370, y: 855, area: 'èª¿æ¼†å®¤å‘å…§' },
            B21: { x: 355, y: 853, area: 'å™´ç ‚å®¤å…§å‘å¾Œ' },
            B22: { x: 370, y: 692, area: 'èª¿æ¼†å®¤å‘å¤–' },
            B23: { x: 127, y: 2017, area: 'å½°æ¿±è¥¿2Få¾Œ' },
            B24: { x: 68, y: 855, area: 'å·¦å¾Œå··-2' },

            // Cå€
            C1: { x: 2054, y: 614, area: 'è­¦è¡›å®¤å‘å¤§é–€' },
            C2: { x: 2167, y: 1107, area: 'å·¦å°é–€' },
            C3: { x: 2153, y: 850, area: 'é…é›»å®¤å‘å·¦å°é–€' },
            C4: { x: 2050, y: 863, area: 'é…é›»å®¤å‘å»£å ´' },
            C5: { x: 2044, y: 614, area: 'è­¦è¡›å®¤å‘å»£å ´' },
            C6: { x: 2170, y: 642, area: 'å¤–å·¦å¤§é–€' },
            C7: { x: 2170, y: 423, area: 'å¤–å³å¤§é–€' },
            C8: { x: 2165, y: 61, area: 'å³å‰åœç‰†' },
            C9: { x: 1405, y: 135, area: 'å» å¤–å³å‰å‘å‰' },
            C10: { x: 1404, y: 422, area: 'å‰æ²é–€å¤–å³å´' },
            C11: { x: 1404, y: 580, area: 'å‰æ²é–€å¤–å·¦å´' },
            C12: { x: 1405, y: 863, area: 'å» å¤–å·¦å‰å‘å‰' },
            C13: { x: 1535, y: 1063, area: 'å·¦åœç‰†ä¸­å‰' },
            C14: { x: 950, y: 1018, area: 'å·¦åœç‰†ä¸­å¾Œ' },
            C15: { x: 1394, y: 875, area: 'å» å¤–å·¦å‰å‘å¾Œ' },
            C16: { x: 930, y: 878, area: 'å·¦ä¸­æ²é–€å‘å‰' },
            C17: { x: 990, y: 878, area: 'å·¦ä¸­æ²é–€å‘å¾Œ' },
            C18: { x: 600, y: 874, area: 'é›»æ°£å®¤æ¨“æ¢¯å‰' },
            C19: { x: 440, y: 878, area: 'å·¦å¾Œæ²é–€å‘å¾Œ' },
            C20: { x: 125, y: 873, area: 'å» å¤–å·¦å¾Œå‘å‰' },
            C21: { x: 115, y: 868, area: 'å» å¤–å·¦å¾Œå‘å¾Œ' },
            C22: { x: 117, y: 128, area: 'å» å¤–å³å¾Œå‘å¾Œ' },
            C23: { x: 33, y: 60, area: 'å³å¾Œåœç‰†' },
            C24: { x: 125, y: 124, area: 'å» å¤–å³å¾Œå‘å‰' },

            // Då€
            D1: { x: 2175, y: 580, area: 'é–€éˆ´' },
            D2: { x: 2066, y: 626, area: 'è­¦è¡›å®¤å±‹ç°·å‘å¤–' },
           
        };

        let currentZoom = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let selectedCamera = null;
        let panLocked = false; // æ§åˆ¶å¹³ç§»é–å®š

        // åˆå§‹åŒ–
        function init() {
            createCameraButtons();
            createCameraMarkers();
            setupEventListeners();
            updateInfoPanel();
        }

        // å‰µå»ºç›£è¦–å™¨æŒ‰éˆ•
        function createCameraButtons() {
            Object.keys(cameras).forEach(zone => {
                const container = document.getElementById(`zone${zone}`);
                cameras[zone].forEach(camera => {
                    const button = document.createElement('button');
                    button.className = 'camera-btn';
                    button.textContent = camera;
                    button.onclick = () => selectCamera(camera);
                    container.appendChild(button);
                });
            });
        }

        // å‰µå»ºç›£è¦–å™¨æ¨™è¨˜
        function createCameraMarkers() {
            const mapContent = document.getElementById('mapContent');
            
            Object.keys(cameras).forEach(zone => {
                cameras[zone].forEach(camera => {
                    const marker = document.createElement('div');
                    marker.className = 'camera-marker';
                    marker.id = `marker-${camera}`;
                    
                    // ä½¿ç”¨å¯¦éš›ä½ç½®åº§æ¨™
                    const pos = cameraPositions[camera];
                    if (pos) {
                        marker.style.left = pos.x + 'px';
                        marker.style.top = pos.y + 'px';
                        marker.onclick = () => selectCamera(camera);
                        
                        const label = document.createElement('div');
                        label.className = 'label';
                        label.textContent = camera;
                        marker.appendChild(label);
                        
                        mapContent.appendChild(marker);
                    }
                });
            });
        }

        // é¸æ“‡ç›£è¦–å™¨
        function selectCamera(cameraId) {
            // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });

            // è¨­ç½®æ–°çš„é¸æ“‡
            selectedCamera = cameraId;
            const button = [...document.querySelectorAll('.camera-btn')].find(btn => btn.textContent === cameraId);
            const marker = document.getElementById(`marker-${cameraId}`);
            
            if (button) button.classList.add('active');
            if (marker) marker.classList.add('active');

            // ç§»å‹•åˆ°ç›£è¦–å™¨ä½ç½®
            const pos = cameraPositions[cameraId];
            
            if (pos) {
                panToPosition(pos.x, pos.y);
                const zone = cameraId.charAt(0);
                updateInfoPanel(cameraId, zone, pos.area);
            }

            // æ‰‹æ©Ÿç«¯è‡ªå‹•é—œé–‰å´é‚Šæ¬„
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        // ç§»å‹•åˆ°æŒ‡å®šä½ç½®
        function panToPosition(x, y) {
            const container = document.getElementById('mapContainer');
            const containerRect = container.getBoundingClientRect();
            
            // è¨ˆç®—å±…ä¸­ä½ç½®
            const centerX = containerRect.width / 2;
            const centerY = containerRect.height / 2;
            
            currentX = centerX - x * currentZoom;
            currentY = centerY - y * currentZoom;
            
            updateMapTransform();
        }

        // æ›´æ–°åœ°åœ–è®Šæ›
        function updateMapTransform() {
            const mapContent = document.getElementById('mapContent');
            mapContent.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentZoom})`;
        }

        // ç¸®æ”¾åŠŸèƒ½
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 5);
            updateMapTransform();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.5);
            updateMapTransform();
        }

        // æœå°‹åŠŸèƒ½

        // è™•ç†æœå°‹è¼¸å…¥
        function handleSearchInput() {
            toggleClearButton();
            searchCameras();
        }

        function searchCameras() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
            let visibleCount = 0;
            let lastVisibleDevice = null;
    
            // éæ­·æ‰€æœ‰ç›£è¦–å™¨æŒ‰éˆ•
            document.querySelectorAll('.camera-btn').forEach((button) => {
                const cameraId = button.textContent;
        
                if (cameraId.toLowerCase().includes(searchTerm)) {
                    button.style.display = 'block';
                    visibleCount++;
                    lastVisibleDevice = cameraId;
                } else {
                    button.style.display = 'none';
                }
            });
    
            // å¦‚æœæœå°‹çµæœå”¯ä¸€ï¼Œè‡ªå‹•é¸æ“‡
            if (visibleCount === 1 && lastVisibleDevice) {
                selectCamera(lastVisibleDevice);

                // ğŸ”¥ è®“æœå°‹æ¡†å¤±å»ç„¦é»ï¼Œæ”¶èµ·éµç›¤
                document.getElementById('searchInput').blur();
            }
        }

        // æ–°å¢ï¼šé¡¯ç¤º/éš±è—æ¸…é™¤æŒ‰éˆ•
        function toggleClearButton() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
    
            if (searchInput.value.length > 0) {
                clearBtn.style.display = 'flex';
            } else {
                clearBtn.style.display = 'none';
            }
        }

        // æ–°å¢ï¼šæ¸…é™¤æœå°‹
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = '';
    
            // éš±è—æ¸…é™¤æŒ‰éˆ•
            toggleClearButton();
    
            // é¡¯ç¤ºæ‰€æœ‰æŒ‰éˆ•
            document.querySelectorAll('.camera-btn').forEach((button) => {
                button.style.display = 'block';
            });
    
            // æ¸…é™¤é¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });
    
            // é‡ç½®é¸æ“‡çš„ç›£è¦–å™¨
            selectedCamera = null;
    
    }

        // æ›´æ–°è³‡è¨Šé¢æ¿
        function updateInfoPanel(cameraId, zone, area) {
            const panel = document.getElementById('infoPanel');
            
            if (cameraId) {
                document.getElementById('infoTitle').textContent = `ç›£è¦–å™¨ ${cameraId}`;
                document.getElementById('infoLocation').textContent = `ä½ç½®: ${area}`;
                document.getElementById('infoZone').textContent = `é€£æ¥åŸ : ${zone}`;
                panel.classList.add('active');
            } else {
                document.getElementById('infoTitle').textContent = 'è«‹é¸æ“‡ç›£è¦–å™¨';
                document.getElementById('infoLocation').textContent = 'ä½ç½®: --';
                document.getElementById('infoZone').textContent = 'å€åŸŸ: --';
                panel.classList.remove('active');
            }
        }

        // é—œé–‰è³‡è¨Šé¢æ¿
        function closeInfoPanel() {
            // æ¸…é™¤é¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.camera-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.camera-marker.active').forEach(marker => {
                marker.classList.remove('active');
            });
    
            // é‡ç½®é¸æ“‡çš„ç›£è¦–å™¨
            selectedCamera = null;
    
            // æ›´æ–°è³‡è¨Šé¢æ¿ï¼ˆæœƒè‡ªå‹•éš±è—ï¼‰
            updateInfoPanel();
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            const mapContainer = document.getElementById('mapContainer');
            
            // æ»‘é¼ äº‹ä»¶
            mapContainer.addEventListener('mousedown', startDrag);
            mapContainer.addEventListener('wheel', handleWheel);
            
            // è§¸æ§äº‹ä»¶
            mapContainer.addEventListener('touchstart', handleTouchStart);
            mapContainer.addEventListener('touchmove', handleTouchMove);
            mapContainer.addEventListener('touchend', handleTouchEnd);
            
            // éµç›¤äº‹ä»¶
            document.addEventListener('keydown', handleKeyDown);
        }

        // æ‹–æ‹½åŠŸèƒ½
        function startDrag(e) {
            if (e.button !== 0) return; // åªéŸ¿æ‡‰å·¦éµ

            isDragging = true;
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;

            // åœ¨ document ä¸Šæ·»åŠ äº‹ä»¶ç›£è½å™¨
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
    
            e.preventDefault(); // é˜²æ­¢é¸å–æ–‡å­—
        }

        function drag(e) {
            if (!isDragging) return;
            
            const deltaX = e.clientX - dragStart.x;
            const deltaY = e.clientY - dragStart.y;

            currentX += deltaX;
            currentY += deltaY;
    
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;
    
            updateMapTransform();
        }

        function endDrag() {
            isDragging = false;

            // ç§»é™¤äº‹ä»¶ç›£è½å™¨
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', endDrag);
        }

        // æ»¾è¼ªç¸®æ”¾
        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newZoom = Math.max(0.2, Math.min(5, currentZoom * delta));
            
            if (newZoom !== currentZoom) {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                currentX = x - (x - currentX) * (newZoom / currentZoom);
                currentY = y - (y - currentY) * (newZoom / currentZoom);
                currentZoom = newZoom;
                
                updateMapTransform();
            }
        }

        // è§¸æ§äº‹ä»¶
        let lastTouchDistance = 0;
        let touchStartX = 0;
        let touchStartY = 0;

        function handleTouchStart(e) {
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].clientX - currentX;
                touchStartY = e.touches[0].clientY - currentY;
            } else if (e.touches.length === 2) {
                lastTouchDistance = getTouchDistance(e.touches);
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            
            const mapContainer = document.getElementById('mapContainer');

            if (e.touches.length === 1) {
                // æª¢æŸ¥æ˜¯å¦åœ¨å¹³ç§»é–å®šæœŸé–“
                if (!panLocked) {
                    currentX = e.touches[0].clientX - touchStartX;
                    currentY = e.touches[0].clientY - touchStartY;
                    updateMapTransform();
                }

            } else if (e.touches.length === 2) {
                const distance = getTouchDistance(e.touches);

                // ğŸ”¥ å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é›™æŒ‡ï¼Œåˆå§‹åŒ–è·é›¢
                if (lastTouchDistance === 0) {
                    lastTouchDistance = distance;
                    return; // é€™æ¬¡ä¸è¨ˆç®—ç¸®æ”¾ï¼Œç­‰ä¸‹æ¬¡ move å†ç®—
                }

                const delta = distance / lastTouchDistance;

                // ğŸ”¥ åªåœ¨ç¸®æ”¾è®ŠåŒ–æ˜é¡¯æ™‚æ‰æ›´æ–° (æ¸›å°‘å¾®å°æŠ–å‹•)
                if (Math.abs(delta - 1) < 0.01) {
                    lastTouchDistance = distance;
                    return;
                }

                const newZoom = Math.max(0.5, Math.min(5, currentZoom * delta));
                
                if (newZoom !== currentZoom) {
                        // è¨ˆç®—å…©æŒ‡ä¸­å¿ƒé»
                        const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                        const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;

                        const rect = mapContainer.getBoundingClientRect();

                        // è¢å¹•ä¸Šçš„é»ç›¸å°æ–¼å®¹å™¨çš„ä½ç½®
                        const pointX = centerX - rect.left;
                        const pointY = centerY - rect.top;

                        // ğŸ”¥ ä¿å­˜èˆŠçš„ zoom ç”¨æ–¼è¨ˆç®—
                        const oldZoom = currentZoom;
                        const mapX = (pointX - currentX) / oldZoom;
                        const mapY = (pointY - currentY) / oldZoom;


                        //æ›´æ–°ç¸®æ”¾
                        currentZoom = newZoom;
                     
                        // ğŸ”¥ é‡æ–°è¨ˆç®—åç§»ï¼Œè®“åœ°åœ–ä¸Šçš„é‚£å€‹é»ä¿æŒåœ¨è¢å¹•ä¸Šçš„åŒä¸€ä½ç½®
                        // è¢å¹•åº§æ¨™ - (åœ°åœ–åº§æ¨™ * æ–°ç¸®æ”¾) = æ–°åç§»
                        currentX = pointX - mapX * newZoom;
                        currentY = pointY - mapY * newZoom;
                
                    
                    updateMapTransform();

                    // é–å®šå¹³ç§»åŠŸèƒ½0.2ç§’
                    panLocked = true;
                    setTimeout(() => {
                        panLocked = false;
                    }, 200);
                }
                
                lastTouchDistance = distance;
            }
        }

        function handleTouchEnd(e) {
            if (e.touches.length === 0) {
                touchStartX = 0;
                touchStartY = 0;
                lastTouchDistance = 0;
            }
        }

        function getTouchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // éµç›¤å¿«æ·éµ
        function handleKeyDown(e) {
            switch(e.key) {
                case '+':
                case '=':
                    zoomIn();
                    break;
                case '-':
                    zoomOut();
                    break;
                case 'Escape':
                    selectedCamera = null;
                    document.querySelectorAll('.camera-btn.active').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelectorAll('.camera-marker.active').forEach(marker => {
                        marker.classList.remove('active');
                    });
                    updateInfoPanel();
                    break;
            }
        }

        // å´é‚Šæ¬„åˆ‡æ›
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // åˆå§‹åŒ–ç³»çµ±
        init();

        function closeModal() {
            document.getElementById("pdfModal").style.display = "none";
            localStorage.setItem("pdfModalClosed", "true"); // è¨˜éŒ„å·²é—œé–‰
        }

        function showPdfModal() {
          document.getElementById("pdfModal").style.display = "block";
        }

        window.addEventListener('load', () => {
            // å¦‚æœ localStorage è£¡æ²’æœ‰è¨˜éŒ„ï¼Œé¡¯ç¤ºå½ˆçª—
            if (!localStorage.getItem("pdfModalClosed")) {
                setTimeout(() => {
                    document.getElementById("pdfModal").style.display = "block";
                }, 500); // å»¶é² 0.5 ç§’è·³å‡º
            }
        });


    </script>
    </script>

    <!-- ğŸ“„ ä½¿ç”¨èªªæ˜å½ˆçª— -->
    <div id="pdfModal" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #FFFFDF;
        padding: 20px 30px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        border-radius: 12px;
        z-index: 3000;
        max-width: 90%;
        width: 400px;
        text-align: center;
        display: none;
    ">
      <button onclick="closeModal()" style="
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #999;
      ">&times;</button>
      <h3 style="margin-bottom: 12px;">ğŸ“„ ä½¿ç”¨èªªæ˜</h3>
      <p>è«‹åƒé–±æ“ä½œæŒ‡å—ï¼š<br>
        <a href="how to use.pdf" target="_blank" style="color: #3498db;">é»æˆ‘ä¸‹è¼‰ PDF</a>
      </p>
    </div>


</body>
</html>